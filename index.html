<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fortnite Clone avec Bots</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #1a1a1a;
            font-family: Arial, sans-serif;
        }
        #game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #game-canvas {
            width: 100%;
            height: 100%;
        }
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        #player-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: white;
        }
        #health-bar {
            width: 200px;
            height: 20px;
            background-color: #333;
            border-radius: 10px;
            overflow: hidden;
        }
        #health-bar::after {
            content: '';
            display: block;
            width: 100%;
            height: 100%;
            background-color: #f00;
            border-radius: 10px;
            transition: width 0.3s;
        }
        #ammo-count {
            margin-top: 10px;
            font-size: 16px;
        }
        #score-display {
            position: absolute;
            top: 20px;
            left: 20px;
            color: white;
            font-size: 18px;
        }
        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }
        #lobby {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        #lobby input {
            padding: 10px;
            border: none;
            border-radius: 5px;
            width: 200px;
        }
        #lobby button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            cursor: pointer;
        }
        #lobby button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="game-canvas"></div>
        <div id="ui">
            <div id="player-info">
                <div id="health-bar"></div>
                <div id="ammo-count">Munitions: 30</div>
            </div>
            <div id="score-display">Score: 0</div>
            <div id="game-over">
                <h2>Game Over !</h2>
                <p>Score final: <span id="final-score">0</span></p>
                <button id="restart-btn">Rejouer</button>
            </div>
        </div>
        <div id="lobby">
            <h2>Bienvenue dans le Lobby</h2>
            <input type="text" id="player-name" placeholder="Entrez votre pseudo">
            <button id="start-btn">Commencer la partie</button>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // Variables de jeu
        let health = 100;
        let ammo = 30;
        let score = 0;
        let currentWeapon = "SCAR";
        let isGameOver = false;
        let playerName = "";
        let isInBus = true;
        let busPosition = 0;

        // Initialisation du jeu
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('game-canvas').appendChild(renderer.domElement);

        // Position de la caméra
        camera.position.y = 5;
        camera.position.z = 10;

        // Lumière
        const light = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(light);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(10, 10, 10);
        scene.add(directionalLight);

        // Sol avec texture
        const groundGeometry = new THREE.PlaneGeometry(100, 100);
        const groundMaterial = new THREE.MeshBasicMaterial({ color: 0x228B22 });
        const ground = new THREE.Mesh(groundGeometry, groundMaterial);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // Montagnes
        const mountainGeometry = new THREE.BoxGeometry(10, 5, 10);
        const mountainMaterial = new THREE.MeshBasicMaterial({ color: 0x8B4513 });
        const mountain = new THREE.Mesh(mountainGeometry, mountainMaterial);
        mountain.position.set(15, 2.5, 15);
        scene.add(mountain);

        // Bus
        const busGeometry = new THREE.BoxGeometry(5, 2, 10);
        const busMaterial = new THREE.MeshBasicMaterial({ color: 0x0000ff });
        const bus = new THREE.Mesh(busGeometry, busMaterial);
        bus.position.y = 2;
        scene.add(bus);

        // Joueur (humain simplifié)
        const playerGeometry = new THREE.BoxGeometry(0.5, 1.5, 0.5);
        const playerMaterial = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
        const player = new THREE.Mesh(playerGeometry, playerMaterial);
        player.position.y = 2;
        scene.add(player);

        // Bots (humains simplifiés)
        const bots = [];
        const botGeometry = new THREE.BoxGeometry(0.5, 1.5, 0.5);
        const botMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000 });

        // Coffres
        const chests = [];
        const chestGeometry = new THREE.BoxGeometry(0.5, 0.5, 0.5);
        const chestMaterial = new THREE.MeshBasicMaterial({ color: 0x8B4513 });

        // Fonction pour ajouter un coffre
        function addChest() {
            const chest = new THREE.Mesh(chestGeometry.clone(), chestMaterial);
            chest.position.x = (Math.random() - 0.5) * 50;
            chest.position.z = (Math.random() - 0.5) * 50;
            scene.add(chest);
            chests.push(chest);
        }

        // Ajouter 5 coffres au début
        for (let i = 0; i < 5; i++) {
            addChest();
        }

        // Fonction pour ajouter un bot
        function addBot() {
            const bot = new THREE.Mesh(botGeometry.clone(), botMaterial);
            bot.position.x = (Math.random() - 0.5) * 20;
            bot.position.z = (Math.random() - 0.5) * 20;
            scene.add(bot);
            bots.push(bot);
        }

        // Ajouter 5 bots au début
        for (let i = 0; i < 5; i++) {
            addBot();
        }

        // Contrôles du joueur
        const keys = {
            z: false, q: false, s: false, d: false, space: false
        };

        document.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() in keys) {
                keys[e.key.toLowerCase()] = true;
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key.toLowerCase() in keys) {
                keys[e.key.toLowerCase()] = false;
            }
        });

        // Boucle de jeu
        function animate() {
            if (isGameOver) return;

            requestAnimationFrame(animate);

            // Déplacement du bus
            if (isInBus) {
                bus.position.x += 0.1;
                player.position.x = bus.position.x;
                player.position.z = bus.position.z;
            }

            // Sauter du bus
            if (keys.space && isInBus) {
                isInBus = false;
                player.position.y = 2;
            }

            // Déplacement du joueur
            if (!isInBus) {
                if (keys.z) player.position.z -= 0.1;
                if (keys.s) player.position.z += 0.1;
                if (keys.q) player.position.x -= 0.1;
                if (keys.d) player.position.x += 0.1;
            }

            // Tir (barre d'espace)
            if (keys.space && ammo > 0 && !isInBus) {
                ammo--;
                document.getElementById('ammo-count').textContent = `Munitions: ${ammo}`;

                // Vérifier si on touche un bot
                for (let i = 0; i < bots.length; i++) {
                    const bot = bots[i];
                    const distance = Math.sqrt(
                        Math.pow(player.position.x - bot.position.x, 2) +
                        Math.pow(player.position.z - bot.position.z, 2)
                    );

                    if (distance < 1.5) {
                        scene.remove(bot);
                        bots.splice(i, 1);
                        score += 10;
                        document.getElementById('score-display').textContent = `Score: ${score}`;
                        addBot(); // Ajouter un nouveau bot
                        break;
                    }
                }
            }

            // Vérifier si on ouvre un coffre
            for (let i = 0; i < chests.length; i++) {
                const chest = chests[i];
                const distance = Math.sqrt(
                    Math.pow(player.position.x - chest.position.x, 2) +
                    Math.pow(player.position.z - chest.position.z, 2)
                );

                if (distance < 1) {
                    scene.remove(chest);
                    chests.splice(i, 1);
                    ammo += 30;
                    document.getElementById('ammo-count').textContent = `Munitions: ${ammo}`;
                    addChest(); // Ajouter un nouveau coffre
                    break;
                }
            }

            // Déplacement aléatoire des bots
            for (const bot of bots) {
                bot.position.x += (Math.random() - 0.5) * 0.1;
                bot.position.z += (Math.random() - 0.5) * 0.1;

                // Vérifier si le bot touche le joueur
                const distance = Math.sqrt(
                    Math.pow(player.position.x - bot.position.x, 2) +
                    Math.pow(player.position.z - bot.position.z, 2)
                );

                if (distance < 1) {
                    health -= 10;
                    document.getElementById('health-bar').style.setProperty('--health', `${health}%`);

                    if (health <= 0) {
                        gameOver();
                    }
                }
            }

            // Mettre à jour la barre de vie
            document.getElementById('health-bar').style.setProperty('--health', `${health}%`);

            // Mettre à jour la caméra
            camera.lookAt(player.position);

            renderer.render(scene, camera);
        }

        // Fin de partie
        function gameOver() {
            isGameOver = true;
            document.getElementById('final-score').textContent = score;
            document.getElementById('game-over').style.display = 'block';
        }

        // Bouton de rejouer
        document.getElementById('restart-btn').addEventListener('click', function() {
            isGameOver = false;
            health = 100;
            ammo = 30;
            score = 0;
            isInBus = true;
            document.getElementById('health-bar').style.setProperty('--health', '100%');
            document.getElementById('ammo-count').textContent = `Munitions: ${ammo}`;
            document.getElementById('score-display').textContent = `Score: ${score}`;
            document.getElementById('game-over').style.display = 'none';

            // Supprimer les anciens bots
            for (const bot of bots) {
                scene.remove(bot);
            }
            bots.length = 0;

            // Supprimer les anciens coffres
            for (const chest of chests) {
                scene.remove(chest);
            }
            chests.length = 0;

            // Ajouter de nouveaux bots
            for (let i = 0; i < 5; i++) {
                addBot();
            }

            // Ajouter de nouveaux coffres
            for (let i = 0; i < 5; i++) {
                addChest();
            }

            animate();
        });

        // Bouton pour commencer la partie
        document.getElementById('start-btn').addEventListener('click', function() {
            playerName = document.getElementById('player-name').value || "Joueur";
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('score-display').textContent = `Score: ${score}`;
            animate();
        });

        // Gestion du redimensionnement
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
