<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Battle Royale Prototype</title>
<style>
    body {
        margin:0;
        background:#0b0c14;
        font-family: Arial;
        color:white;
    }

    /* --- LOBBY --- */
    #lobby {
        padding:20px;
    }
    .mode-btn {
        padding:10px 20px;
        margin:5px;
        background:#2a2d3a;
        border:1px solid #555;
        cursor:pointer;
        display:inline-block;
    }
    #readyBtn {
        margin-top:20px;
        padding:15px 30px;
        background:#00aaff;
        cursor:pointer;
        font-size:22px;
        display:inline-block;
    }

    /* --- JEU --- */
    #game {
        display:none;
        background:#111;
        height:100vh;
        overflow:hidden;
        position:relative;
    }
    #map {
        width:2000px;
        height:2000px;
        background:#2b923a;
        position:absolute;
        top:0;
        left:0;
    }
    .player {
        width:20px;
        height:20px;
        background:yellow;
        position:absolute;
    }
    .zone {
        position:absolute;
        border:3px solid #4affff;
        border-radius:50%;
    }
    .chest {
        width:20px;
        height:20px;
        background:orange;
        border-radius:4px;
        position:absolute;
    }

    #lootBox {
        position:fixed;
        bottom:20px;
        left:50%;
        transform:translateX(-50%);
        padding:15px;
        background:#0008;
        display:none;
    }
</style>
</head>

<body>

<!-- ------------------- LOBBY ------------------- -->
<div id="lobby">
    <h1>Battle Royale – Lobby</h1>

    <h3>Choisir le mode</h3>
    <div class="mode-btn" onclick="setMode('Solo')">Solo</div>
    <div class="mode-btn" onclick="setMode('Duo')">Duo</div>
    <div class="mode-btn" onclick="setMode('Section')">Section</div>

    <h3 id="modeLabel">Mode sélectionné : Solo</h3>

    <div id="readyBtn" onclick="launchGame()">PRÊT !</div>
</div>


<!-- ------------------- GAME ------------------- -->
<div id="game">
    <div id="map"></div>
    <div id="lootBox"></div>
</div>


<script>
/* ------------------- VARIABLES ------------------- */
let mode = "Solo";
let player = { x:1000, y:1000, speed:4 };
let keys = {};
let zoneSize = 1800;
let zonePhase = 1;
let zoneDamage = 0;
let maxPhase = 8;


/* ------------------- MODE SELECTION ------------------- */
function setMode(m) {
    mode = m;
    document.getElementById("modeLabel").innerText = "Mode sélectionné : " + m;
}

/* ------------------- START GAME ------------------- */
function launchGame() {
    document.getElementById("lobby").style.display = "none";
    document.getElementById("game").style.display = "block";
    spawnPlayer();
    spawnChests(40);
    startZoneShrink();
    gameLoop();
}

/* ------------------- PLAYER ------------------- */
function spawnPlayer() {
    let el = document.createElement("div");
    el.className = "player";
    document.getElementById("map").appendChild(el);
    player.el = el;
}

/* ZQSD */
document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* ------------------- GAME LOOP ------------------- */
function gameLoop() {
    if(keys["z"]) player.y -= player.speed;
    if(keys["s"]) player.y += player.speed;
    if(keys["q"]) player.x -= player.speed;
    if(keys["d"]) player.x += player.speed;

    player.el.style.left = player.x + "px";
    player.el.style.top  = player.y + "px";

    checkZoneDamage();

    requestAnimationFrame(gameLoop);
}

/* ------------------- ZONE ------------------- */
function startZoneShrink() {
    let zone = document.createElement("div");
    zone.id = "zone";
    zone.className = "zone";
    document.getElementById("map").appendChild(zone);
    updateZone();
}

function updateZone() {
    let z = document.getElementById("zone");
    z.style.width = zoneSize + "px";
    z.style.height = zoneSize + "px";
    z.style.left = (1000 - zoneSize/2) + "px";
    z.style.top =  (1000 - zoneSize/2) + "px";

    // Damage phases
    if(zonePhase <= 3) zoneDamage = 1;
    else if(zonePhase <= 5) zoneDamage = 2;
    else zoneDamage = 5;

    if(zonePhase < maxPhase) {
        zoneSize -= 150;
        zonePhase++;
        setTimeout(updateZone, 10000);
    }
}

function checkZoneDamage() {
    let d = distance(player.x, player.y, 1000, 1000);
    if(d > zoneSize/2) {
        // Outside zone
        console.log("YOU TAKE DAMAGE: ", zoneDamage);
    }
}

function distance(x1,y1,x2,y2) {
    return Math.sqrt( (x1-x2)**2 + (y1-y2)**2 );
}

/* ------------------- CHESTS & LOOT ------------------- */
let weapons = ["SCAR", "SPAS‑12", "FAMAS", "Pistolet", "SMG"];

function spawnChests(n) {
    for(let i=0;i<n;i++) {
        let c = document.createElement("div");
        c.className = "chest";
        c.style.left = Math.random()*1900 + "px";
        c.style.top  = Math.random()*1900 + "px";
        c.onclick = () => openChest(c);
        document.getElementById("map").appendChild(c);
    }
}

function openChest(c) {
    let loot = weapons[Math.floor(Math.random()*weapons.length)];
    document.getElementById("lootBox").innerText = "Butin : " + loot;
    document.getElementById("lootBox").style.display = "block";
    c.remove();
}
</script>

</body>
</html>
