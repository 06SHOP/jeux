<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Battle Royale</title>

<style>
body {
    margin:0;
    overflow:hidden;
    font-family:Arial, sans-serif;
    color:white;
}

/* ==== LOBBY ==== */
#background {
    position:fixed;
    width:100vw;
    height:100vh;
    background:linear-gradient(160deg,#0c1437,#13296b);
}
.grid {
    position:absolute;
    width:200%;
    height:200%;
    background-image:
      linear-gradient(transparent 97%,rgba(0,170,255,0.3)),
      linear-gradient(90deg,transparent 97%,rgba(0,170,255,0.3));
    background-size:50px 50px;
    animation:gridMove 20s linear infinite;
    opacity:0.25;
}
@keyframes gridMove { 
    from {transform:translate(0,0);}
    to {transform:translate(-200px,-200px);}
}

#lobby {
    position:absolute;
    width:100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:center;
}

#characterLobby {
    width:260px;
    height:480px;
    background:url('https://i.imgur.com/6XJZtqU.png');
    background-size:cover;
    border-radius:20px;
}

#playBtn {
    position:absolute;
    bottom:60px;
    left:50%;
    transform:translateX(-50%);
    padding:20px 70px;
    font-size:30px;
    background:#00aaff;
    border-radius:14px;
    color:#002944;
    font-weight:bold;
    cursor:pointer;
    transition:.3s;
}
#playBtn:hover { transform:translateX(-50%) scale(1.1); }

/* ==== GAME ==== */
#game {
    display:none;
    width:100vw;
    height:100vh;
    background:#74c167;
}

/* ===== MAP ===== */
#map {
    width:3000px;
    height:3000px;
    background:#3ea34d;
    position:absolute;
}

/* ===== PLAYER TPS ===== */
#player {
    width:40px;
    height:80px;
    background:url('https://i.imgur.com/6XJZtqU.png');
    background-size:cover;
    position:absolute;
}

/* ===== BUS ===== */
#bus {
    width:250px;
    height:100px;
    background:#0044ff;
    border:4px solid white;
    border-radius:25px;
    position:absolute;
    top:200px;
    left:-300px;
    z-index:5;
}

/* ====== ZONE ====== */
#zone {
    border:4px solid #00d0ff;
    border-radius:50%;
    position:absolute;
    pointer-events:none;
}
</style>
</head>

<body>

<!-- LOBBY -->
<div id="background"><div class="grid"></div></div>
<div id="lobby">
    <div id="characterLobby"></div>
    <div id="playBtn" onclick="startGame()">JOUER</div>
</div>

<!-- GAME -->
<div id="game">

    <div id="bus"></div>

    <div id="map">
        <div id="zone"></div>
        <div id="player"></div>
    </div>

</div>

<script>
/* ============================
      VARIABLES
============================ */
let player = { x:1500, y:1500, speed:5 };
let keys = {};

let inBus = true;
let falling = false;

let zoneSize = 1800;
let zonePhase = 1;
let maxPhase = 6;

/* ============================
      START LOBBY -> GAME
============================ */
function startGame() {
    document.getElementById("lobby").style.display = "none";
    document.getElementById("game").style.display = "block";

    centerPlayer();
    startBus();
    updateZone();
    gameLoop();
}

/* ============================
      MOVE PLAYER
============================ */
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

function movePlayer() {
    if (falling || inBus) return;

    if (keys["z"]) player.y -= player.speed;
    if (keys["s"]) player.y += player.speed;
    if (keys["q"]) player.x -= player.speed;
    if (keys["d"]) player.x += player.speed;

    updatePlayerPos();
}

/* Center camera on player */
function updatePlayerPos() {
    let p = document.getElementById("player");
    p.style.left = player.x + "px";
    p.style.top = player.y + "px";

    document.getElementById("map").style.left = (-player.x + window.innerWidth/2) + "px";
    document.getElementById("map").style.top = (-player.y + window.innerHeight/2) + "px";
}

function centerPlayer() {
    updatePlayerPos();
}

/* ============================
      BUS ANIMATION
============================ */
function startBus() {
    let bus = document.getElementById("bus");
    let pos = -300;

    function animate() {
        if (!inBus) return;
        pos += 5;
        bus.style.left = pos + "px";

        if (pos > 3500) inBus = false;
        else requestAnimationFrame(animate);
    }
    animate();
}

/* ============================
      SAUT DU BUS
============================ */
document.addEventListener("keydown", e => {
    if (e.key === " " && inBus) {
        inBus = false;
        falling = true;
        document.getElementById("bus").style.display = "none";

        // spawn joueur sous le bus
        player.x = 1500;
        player.y = -300;

        updatePlayerPos();
    }
});

/* ============================
      GRAVITÃ‰
============================ */
function applyGravity() {
    if (!falling) return;

    player.y += 15;
    if (player.y >= 1500) {
        falling = false;
        player.y = 1500;
    }
    updatePlayerPos();
}

/* ============================
      ZONE
============================ */
function updateZone() {
    let z = document.getElementById("zone");

    z.style.width = zoneSize + "px";
    z.style.height = zoneSize + "px";
    z.style.left = (1500 - zoneSize/2) + "px";
    z.style.top = (1500 - zoneSize/2) + "px";

    if (zonePhase < maxPhase) {
        zoneSize -= 200;
        zonePhase++;
        setTimeout(updateZone, 7000);
    }
}

/* ============================
      GAME LOOP
============================ */
function gameLoop() {
    applyGravity();
    movePlayer();
    requestAnimationFrame(gameLoop);
}
</script>

</body>
</html>
